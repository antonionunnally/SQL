-- What is total claim cost for each encounter in 2019?

SELECT SUM(TOTAL_CLAIM_COST) AS TOTAL_FOR_2019
, AVG(TOTAL_CLAIM_COST) AS AVG_FOR_2019
FROM HEALTHCARE.ENCOUNTERS 
WHERE START>='2019-01-01'
AND START<'2020-01-01';

-- What is total payer coverage for each encounter in 2019?

SELECT SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
, AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
,SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
,AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
FROM HEALTHCARE.ENCOUNTERS 
WHERE START>='2019-01-01'
AND START<'2020-01-01';


-- Which encounter types had the highest cost covered by payers?

SELECT 
PAYER
,NAME
,ENCOUNTERCLASS
-- , SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
-- , AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
-- ,SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
-- ,AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
,SUM(TOTAL_CLAIM_COST)  - SUM(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV_TOT
,AVG(TOTAL_CLAIM_COST)  - AVG(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV_AVG
FROM HEALTHCARE.ENCOUNTERS ENC
JOIN HEALTHCARE.PAYERS PAY ON ENC.PAYER=PAY.ID
WHERE START>='2019-01-01'
AND START<'2020-01-01'
GROUP BY PAYER, NAME, ENCOUNTERCLASS
ORDER BY ENCOUNTERCLASS;


-- Which encounter types had the highest cost?

SELECT 
ENCOUNTERCLASS
-- , SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
-- , AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
-- ,SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
-- ,AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
,SUM(TOTAL_CLAIM_COST)  - SUM(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV_TOT
,AVG(TOTAL_CLAIM_COST)  - AVG(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV_AVG
FROM HEALTHCARE.ENCOUNTERS ENC
WHERE START>='2019-01-01'
AND START<'2020-01-01'
GROUP BY ENCOUNTERCLASS
ORDER BY ENCOUNTERCLASS;
